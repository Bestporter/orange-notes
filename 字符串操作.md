# å­—ç¬¦ä¸²çš„åŒ¹é…å’Œæœç´¢

å¦‚æœä½ æƒ³ä½¿ç”¨åŒä¸€ä¸ªæ¨¡å¼å»åšå¤šæ¬¡åŒ¹é…ï¼Œä½ åº”è¯¥å…ˆå°†æ¨¡å¼å­—ç¬¦ä¸²é¢„ç¼–è¯‘ä¸ºæ¨¡å¼å¯¹è±¡ã€‚æ¯”å¦‚ï¼š

```python
import re

s = r'\d+'
match = re.compile(s)
string = '123sadsad123'
print(repr(match.match(string)))  # matchç”¨æ¥åˆ¤æ–­èƒ½å¦åŒ¹é…åˆ°ï¼Œ 
<re.Match object; span=(0, 3), match='123'>
#
for i in match.finditer(string):
  	print()
```

å¦‚æœä½ æƒ³ç²¾ç¡®åŒ¹é…ï¼Œç¡®ä¿ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ä»¥$ç»“å°¾ï¼Œå°±åƒè¿™ä¹ˆè¿™æ ·ï¼š

```python
>>> datepat = re.compile(r'(\d+)/(\d+)/(\d+)$')
>>> datepat.match('11/27/2012abcdef')
>>> datepat.match('11/27/2012')
<_sre.SRE_Match object at 0x1005d2750>
>>>

```

`findall()` æ–¹æ³•ä¼šæœç´¢æ–‡æœ¬å¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›æ‰€æœ‰çš„åŒ¹é…ã€‚ å¦‚æœä½ æƒ³ä»¥è¿­ä»£æ–¹å¼è¿”å›åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `finditer()` æ–¹æ³•æ¥ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š

```python
for i in match.finditer(string):
  	print()
```

### å­—ç¬¦ä¸²æ›¿æ¢

å¯¹äºå¤æ‚çš„æ¨¡å¼ï¼Œè¯·ä½¿ç”¨ `re` æ¨¡å—ä¸­çš„ `sub()` å‡½æ•°ã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸ªï¼Œå‡è®¾ä½ æƒ³å°†å½¢å¼ä¸º `11/27/2012` çš„æ—¥æœŸå­—ç¬¦ä¸²æ”¹æˆ `2012-11-27` ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```python
text = 'Today is 11/27/2012. PyCon starts 3/13/2013. 11/27/2012'
import re
s = re.sub(r'(\d+)/(\d+)/(\d+)', r'\3-\1-\2', text)
print(s)
# Today is 2012-11-27. PyCon starts 2013-3-13. 2012-11-27
```

`sub()` å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«åŒ¹é…çš„æ¨¡å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢æ¨¡å¼ã€‚åæ–œæ æ•°å­—æ¯”å¦‚ `\3` æŒ‡å‘å‰é¢æ¨¡å¼çš„æ•è·ç»„å·ã€‚

å¦‚æœä½ æ‰“ç®—ç”¨ç›¸åŒçš„æ¨¡å¼åšå¤šæ¬¡æ›¿æ¢ï¼Œè€ƒè™‘å…ˆç¼–è¯‘å®ƒæ¥æå‡æ€§èƒ½ã€‚æ¯”å¦‚ï¼š

```python
datepat = re.compile(r'(\d+)/(\d+)/(\d+)')
s = datepat.sub(r'\3-\1-\2', text)
print(s)
# Today is 2012-11-27. PyCon starts 2013-3-13. 2012-11-27
```

å¯¹äºæ›´åŠ å¤æ‚çš„æ›¿æ¢ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæ›¿æ¢å›è°ƒå‡½æ•°æ¥ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š

```python
from calendar import month_abbr
def change_date(m):
    mon_name = month_abbr[int(m.group(1))]
    return '{} {} {}'.format(m.group(2), mon_name, m.group(3))

print(datepat.sub(change_date, text))
# 'Today is 27 Nov 2012. PyCon starts 13 Mar 2013.'
```

ä¸€ä¸ªæ›¿æ¢å›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ª `match` å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ `match()` æˆ–è€… `find()` è¿”å›çš„å¯¹è±¡ã€‚ ä½¿ç”¨ `group()` æ–¹æ³•æ¥æå–ç‰¹å®šçš„åŒ¹é…éƒ¨åˆ†ã€‚å›è°ƒå‡½æ•°æœ€åè¿”å›æ›¿æ¢å­—ç¬¦ä¸²ã€‚

å¦‚æœé™¤äº†æ›¿æ¢åçš„ç»“æœå¤–ï¼Œä½ è¿˜æƒ³çŸ¥é“æœ‰å¤šå°‘æ›¿æ¢å‘ç”Ÿäº†ï¼Œå¯ä»¥ä½¿ç”¨ `re.subn()` æ¥ä»£æ›¿ã€‚æ¯”å¦‚ï¼š

```python
>>> newtext, n = datepat.subn(r'\3-\1-\2', text) # è¿”å›ä¸€ä¸ªtuple
>>> newtext
'Today is 2012-11-27. PyCon starts 2013-3-13.'
>>> n
2
```

é»˜è®¤ä¸ºè´ªå©ªåŒ¹é…ï¼Œé€šè¿‡åœ¨ `*` æˆ–è€… `+` è¿™æ ·çš„æ“ä½œç¬¦åé¢æ·»åŠ ä¸€ä¸ª `?` å¯ä»¥å¼ºåˆ¶åŒ¹é…ç®—æ³•æ”¹æˆå¯»æ‰¾æœ€çŸ­çš„å¯èƒ½åŒ¹é…ã€‚

## `(?:)` æŒ‡å®šäº†ä¸€ä¸ªéæ•è·ç»„

`(?:.|\n)` æŒ‡å®šäº†ä¸€ä¸ªéæ•è·ç»„ (ä¹Ÿå°±æ˜¯å®ƒå®šä¹‰äº†ä¸€ä¸ªä»…ä»…ç”¨æ¥åšåŒ¹é…ï¼Œè€Œä¸èƒ½é€šè¿‡å•ç‹¬æ•è·æˆ–è€…ç¼–å·çš„ç»„)ã€‚

## ä½ æ­£åœ¨è¯•ç€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ä¸€å¤§å—çš„æ–‡æœ¬ï¼Œè€Œä½ éœ€è¦è·¨è¶Šå¤šè¡Œå»åŒ¹é…ã€‚

è¿™ä¸ªé—®é¢˜å¾ˆå…¸å‹çš„å‡ºç°åœ¨å½“ä½ ç”¨ç‚¹(.)å»åŒ¹é…ä»»æ„å­—ç¬¦çš„æ—¶å€™ï¼Œå¿˜è®°äº†ç‚¹(.)ä¸èƒ½åŒ¹é…æ¢è¡Œç¬¦çš„äº‹å®ã€‚

ä¸ºäº†ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä¿®æ”¹æ¨¡å¼å­—ç¬¦ä¸²ï¼Œå¢åŠ å¯¹æ¢è¡Œçš„æ”¯æŒã€‚æ¯”å¦‚ï¼š

```python
>>> comment = re.compile(r'/\*((?:.|\n)*?)\*/')
>>> comment.findall(text2)
[' this is a\n multiline comment ']
>>>
```

`re.compile()` å‡½æ•°æ¥å—ä¸€ä¸ªæ ‡å¿—å‚æ•°å« `re.DOTALL` ï¼Œåœ¨è¿™é‡Œéå¸¸æœ‰ç”¨ã€‚ å®ƒå¯ä»¥è®©æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‚¹(.)åŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦åœ¨å†…çš„ä»»æ„å­—ç¬¦ã€‚æ¯”å¦‚ï¼š

```python
>>> comment = re.compile(r'/\*(.*?)\*/', re.DOTALL)
>>> comment.findall(text2)
[' this is a\n multiline comment ']
```

å¯¹äºç®€å•çš„æƒ…å†µä½¿ç”¨ `re.DOTALL` æ ‡è®°å‚æ•°å·¥ä½œçš„å¾ˆå¥½ï¼Œ ä½†æ˜¯å¦‚æœæ¨¡å¼éå¸¸å¤æ‚æˆ–è€…æ˜¯ä¸ºäº†æ„é€ å­—ç¬¦ä¸²ä»¤ç‰Œè€Œå°†å¤šä¸ªæ¨¡å¼åˆå¹¶èµ·æ¥(2.18èŠ‚æœ‰è¯¦ç»†æè¿°)ï¼Œ è¿™æ—¶å€™ä½¿ç”¨è¿™ä¸ªæ ‡è®°å‚æ•°å°±å¯èƒ½å‡ºç°ä¸€äº›é—®é¢˜ã€‚ å¦‚æœè®©ä½ é€‰æ‹©çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯å®šä¹‰è‡ªå·±çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œè¿™æ ·å®ƒå¯ä»¥åœ¨ä¸éœ€è¦é¢å¤–çš„æ ‡è®°å‚æ•°ä¸‹ä¹Ÿèƒ½å·¥ä½œçš„å¾ˆå¥½ã€‚

## æ­£åˆ™ä¸­åœ†æ‹¬å·çš„ç”¨å¤„

**æ­£åˆ™**è¡¨è¾¾å¼**ä¸­**çš„**åœ†æ‹¬å·**çš„ä½œç”¨**æ˜¯**å¯¹å­—ç¬¦è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¿å­˜åŒ¹é…çš„æ–‡æœ¬ã€‚æ•è·åœ†æ‹¬å·ï¼šæ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œä¸ä½äºåœ†æ‹¬å·ä¹‹é—´çš„æ¨¡å¼åŒ¹é…çš„å†…å®¹éƒ½ä¼šè¢«æ•è·ã€‚



## å°†Unicodeæ–‡æœ¬æ ‡å‡†åŒ–

### ä½ æ­£åœ¨å¤„ç†Unicodeå­—ç¬¦ä¸²ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰å­—ç¬¦ä¸²åœ¨åº•å±‚æœ‰ç›¸åŒçš„è¡¨ç¤ºã€‚

ä½¿ç”¨unicodedataåº“

## æ¸…ç†å­—ç¬¦ä¸²ä¸éœ€è¦çš„å†…å®¹

æ–‡æœ¬æ¸…ç†é—®é¢˜ä¼šæ¶‰åŠåˆ°åŒ…æ‹¬æ–‡æœ¬è§£æä¸æ•°æ®å¤„ç†ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚ åœ¨éå¸¸ç®€å•çš„æƒ…å½¢ä¸‹ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°(æ¯”å¦‚ `str.upper()` å’Œ `str.lower()` )å°†æ–‡æœ¬è½¬ä¸ºæ ‡å‡†æ ¼å¼ã€‚ ä½¿ç”¨ `str.replace()` æˆ–è€… `re.sub()` çš„ç®€å•æ›¿æ¢æ“ä½œèƒ½åˆ é™¤æˆ–è€…æ”¹å˜æŒ‡å®šçš„å­—ç¬¦åºåˆ—ã€‚ ä½ åŒæ ·è¿˜å¯ä»¥ä½¿ç”¨2.9å°èŠ‚çš„ `unicodedata.normalize()` å‡½æ•°å°†unicodeæ–‡æœ¬æ ‡å‡†åŒ–ã€‚

```python
s = 'hello world  sdfsdkfjk     '
print(re.sub('\s+', ' ', s))
```

## æ ¼å¼åŒ–å­—ç¬¦ä¸²

å¾€ >   å¼€å£çš„æ–¹å‘åŠ 

```python
text = 'hellow workdsljf'

m = format(text, '*^20')
print(m)
print(text)
# **hellow workdsljf**
# hellow workdsljf
m = format(text, '*<20')
print(m)# hellow workdsljf****
>>> '{:>10s} {:>10s}'.format('Hello', 'World')
'     Hello      World'
>>>
```

`format()` å‡½æ•°çš„ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒä¸ä»…é€‚ç”¨äºå­—ç¬¦ä¸²ã€‚å®ƒå¯ä»¥ç”¨æ¥æ ¼å¼åŒ–ä»»ä½•å€¼ï¼Œä½¿å¾—å®ƒéå¸¸çš„é€šç”¨ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥æ ¼å¼åŒ–æ•°å­—ï¼š  

```python
>>> x = 1.2345
>>> format(x, '>10')
'    1.2345'
>>> format(x, '^10.2f')
'   1.23   '
>>>
```

## åˆå¹¶æ‹¼æ¥å­—ç¬¦ä¸²

joinæ–¹æ³•ï¼Œ å°æŠ€å·§ï¼ˆç”¨ç”Ÿæˆå™¨ï¼‰

åªæ˜¯æ‰“å°ä¸€äº›æ•°æ®

ğŸˆ¯ï¸

```python
print(a + ':' + b + ':' + c) # Ugly
print(':'.join([a, b, c])) # Still ugly
print(a, b, c, sep=':') # Better
```

```python
def sample():
    yield 'Is'
    yield 'Chicago'
    yield 'Not'
    yield 'Chicago?'
def combine(source, maxsize):
    parts = []
    size = 0
    for part in source:
        parts.append(part)
        size += len(part)
        if size > maxsize:
            yield ''.join(parts)
            parts = []
            size = 0
    yield ''.join(parts)

# ç»“åˆæ–‡ä»¶æ“ä½œ
with open('filename', 'w') as f:
    for part in combine(sample(), 32768):
        f.write(part)
```

## vars()å‡½æ•°

**vars()** å‡½æ•°è¿”å›å¯¹è±¡objectçš„å±æ€§å’Œå±æ€§å€¼çš„å­—å…¸å¯¹è±¡ã€‚

å¦‚æœè¦è¢«æ›¿æ¢çš„å˜é‡èƒ½åœ¨å˜é‡åŸŸä¸­æ‰¾åˆ°ï¼Œ é‚£ä¹ˆä½ å¯ä»¥ç»“åˆä½¿ç”¨ `format_map()` å’Œ `vars()` ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼š

```python
>>> name = 'Guido'
>>> n = 37
>>> s.format_map(vars())
'Guido has 37 messages.'
>>>
```

`format` å’Œ `format_map()` çš„ä¸€ä¸ªç¼ºé™·å°±æ˜¯å®ƒä»¬å¹¶ä¸èƒ½å¾ˆå¥½çš„å¤„ç†å˜é‡ç¼ºå¤±çš„æƒ…å†µ.

ä¸€ç§é¿å…è¿™ç§é”™è¯¯çš„æ–¹æ³•æ˜¯å¦å¤–å®šä¹‰ä¸€ä¸ªå«æœ‰ `__missing__()` æ–¹æ³•çš„å­—å…¸å¯¹è±¡ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```python
class safesub(dict):
"""é˜²æ­¢keyæ‰¾ä¸åˆ°"""
		def __missing__(self, key):
    		return '{' + key + '}'
```

ç°åœ¨ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªç±»åŒ…è£…è¾“å…¥åä¼ é€’ç»™ `format_map()` ï¼š

```python
>>> del n # Make sure n is undefined
>>> s.format_map(safesub(vars()))
'Guido has {n} messages.'
>>>
```

æ˜ å°„æˆ–è€…**å­—å…¸ç±»ä¸­é²œä¸ºäººçŸ¥çš„ `__missing__()` æ–¹æ³•å¯ä»¥è®©ä½ å®šä¹‰å¦‚ä½•å¤„ç†ç¼ºå¤±çš„å€¼ã€‚** åœ¨ `SafeSub` ç±»ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å®šä¹‰ä¸ºå¯¹ç¼ºå¤±çš„å€¼è¿”å›ä¸€ä¸ªå ä½ç¬¦ã€‚ ä½ å¯ä»¥å‘ç°ç¼ºå¤±çš„å€¼ä¼šå‡ºç°åœ¨ç»“æœå­—ç¬¦ä¸²ä¸­(åœ¨è°ƒè¯•çš„æ—¶å€™å¯èƒ½å¾ˆæœ‰ç”¨)ï¼Œè€Œä¸æ˜¯äº§ç”Ÿä¸€ä¸ª `KeyError` å¼‚å¸¸ã€‚

`sub()` å‡½æ•°ä½¿ç”¨ `sys._getframe(1)` è¿”å›è°ƒç”¨è€…çš„æ ˆå¸§ã€‚å¯ä»¥ä»ä¸­è®¿é—®å±æ€§ `f_locals` æ¥è·å¾—å±€éƒ¨å˜é‡ã€‚ æ¯«æ— ç–‘é—®ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹åœ¨ä»£ç ä¸­å»ç›´æ¥æ“ä½œæ ˆå¸§åº”è¯¥æ˜¯ä¸æ¨èçš„ã€‚ ä½†æ˜¯ï¼Œå¯¹äºåƒå­—ç¬¦ä¸²æ›¿æ¢å·¥å…·å‡½æ•°è€Œè¨€å®ƒæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ `f_locals` æ˜¯ä¸€ä¸ªå¤åˆ¶è°ƒç”¨å‡½æ•°çš„æœ¬åœ°å˜é‡çš„å­—å…¸ã€‚ å°½ç®¡ä½ å¯ä»¥æ”¹å˜ `f_locals` çš„å†…å®¹ï¼Œä½†æ˜¯è¿™ä¸ªä¿®æ”¹å¯¹äºåé¢çš„å˜é‡è®¿é—®æ²¡æœ‰ä»»ä½•å½±å“ã€‚ æ‰€ä»¥ï¼Œè™½è¯´è®¿é—®ä¸€ä¸ªæ ˆå¸§çœ‹ä¸Šå»å¾ˆé‚ªæ¶ï¼Œä½†æ˜¯å¯¹å®ƒçš„ä»»ä½•æ“ä½œä¸ä¼šè¦†ç›–å’Œæ”¹å˜è°ƒç”¨è€…æœ¬åœ°å˜é‡çš„å€¼ã€‚



## å­—ç¬¦ä¸²è½¬htmlæ ¼å¼

```python
>>> s = 'Elements are written as "<tag>text</tag>".'
>>> import html
>>> print(s)
Elements are written as "<tag>text</tag>".


>>> print(html.escape(s))
Elements are written as &quot;&lt;tag&gt;text&lt;/tag&gt;&quot;.

>>> # Disable escaping of quotes
>>> print(html.escape(s, quote=False))
Elements are written as "&lt;tag&gt;text&lt;/tag&gt;".
>>>
```

## htmlæ ¼å¼è½¬å­—ç¬¦ä¸²

```python
>>> s = 'Spicy &quot;Jalape&#241;o&quot.'
>>> from html.parser import HTMLParser
>>> p = HTMLParser()
>>> p.unescape(s)
'Spicy "JalapeÃ±o".'
>>>
>>> t = 'The prompt is &gt;&gt;&gt;'
>>> from xml.sax.saxutils import unescape
>>> unescape(t)
'The prompt is >>>'
>>>
```

